// Project: Egg Hunt 
// Author: John Yu
// Created: 2018-04-09

// show all errors
SetErrorMode(2)

// set window properties
SetWindowTitle( "Egg Hunt" )
SetWindowSize( 640, 480, 0 )
SetWindowAllowResize( 1 ) // allow the user to resize the window

// set display properties
SetVirtualResolution( 640, 480 ) // doesn't have to match the window
SetOrientationAllowed( 1, 1, 1, 1 ) // allow both portrait and landscape on mobile devices
SetSyncRate( 30, 0 ) // 30fps instead of 60 to save battery
SetScissor( 0,0,0,0 ) // use the maximum available screen space, no black borders
UseNewDefaultFonts( 1 ) // since version 2.0.22 we can use nicer default fonts

//// ******** To-Do List ******** ////

// 1. Add some pictures for start screen //
// 2. Add feature where the longer an egg is not picked up the less points it will be worth
// 3. Clean up code
// 4. Change Timer System
// 5. Add Tutorial

/* Notes:
Subroutines are a programming tool that separates 
the program into individual algorithms so that 
they can be added or removed from the program
with relative ease. (aside, multiple programmers 
can work on the same program by assigning different 
subroutines to each programmer). Subroutines are 
also a precursor to Functions (CS20) where functions
take a variable and modify it.

In python, subroutines appear at the top: however,
in BASIC, they are written at the bottom.
*/


// **** Everything **** //
do

// **** Variables **** //
score = 0
time = 10 // This is the in-game time
second = 0 // Just to keep track of one second
speed = 0
	
// **** Images **** //
LoadImage(1, "bunny.png")
LoadImage(2, "egg1.png")
LoadImage(3, "egg2.png")
CreateImageColor(4, 52, 180, 54, 255) // Light-Green Color
CreateImageColor(5, 255, 255, 255, 255) // White Color
CreateImageColor(6, 124, 252, 0, 255) // Grass-Green Color
CreateImageColor(7, 150, 150, 150, 255) // Grey Color

// **** Start Menu **** //

// Background //
CreateSprite(6, 4) // Background
SetSpriteSize(6, GetVirtualWidth(), GetVirtualHeight())

// Play Button //
play = CreateText("Play")
SetTextSize(play, 50)
SetTextColor(play, 255, 0, 0, 255)
playx = GetVirtualWidth()/2 - GetTextTotalWidth(play)/2
playy = GetVirtualHeight()/2 - GetTextTotalHeight(play)/2
SetTextPosition(play, playx, playy)

// Start Menu Commands //
do
	if GetTextHitTest(play, GetPointerX(), GetPointerY())
		SetTextSize(play, 55)
		playx = GetVirtualWidth()/2 - GetTextTotalWidth(play)/2
		playy = GetVirtualHeight()/2 - GetTextTotalHeight(play)/2
		SetTextPosition(play, playx, playy)
		if GetPointerReleased() = 1
			DeleteAllText()
			DeleteAllSprites()
			exit
		endif
	else
		SetTextSize(play, 50)
		playx = GetVirtualWidth()/2 - GetTextTotalWidth(play)/2
		playy = GetVirtualHeight()/2 - GetTextTotalHeight(play)/2
		SetTextPosition(play, playx, playy)
	endif
	sync()
loop

// **** Difficulty Chooser **** //

// Background //
CreateSprite(7, 4) 
SetSpriteSize(7, GetVirtualWidth(), GetVirtualHeight())

// Easy Button //
CreateText(8, "Easy")
SetTextSize(8, 50)
SetTextColor(8, 0, 255, 0, 255) // Green
easyx = GetVirtualWidth()/2 - GetTextTotalWidth(8)/2
easyy = GetVirtualHeight()/2 - GetTextTotalHeight(8)*2
SetTextPosition(8, easyx, easyy)

// Intermediate Button //
CreateText(9, "Intermediate")
SetTextSize(9, 50)
SetTextColor(9, 255, 155, 0, 255) // Orange
mediumx = GetVirtualWidth()/2 - GetTextTotalWidth(9)/2
mediumy = GetVirtualHeight()/2 - GetTextTotalHeight(9)
SetTextPosition(9, mediumx, mediumy)

// Hard Button //
CreateText(10, "Hard")
SetTextSize(10, 50)
SetTextColor(10, 255, 0, 0, 255) // Red
hardx = GetVirtualWidth()/2 - GetTextTotalWidth(10)/2
hardy = GetVirtualHeight()/2 
SetTextPosition(10, hardx, hardy)

// Insane Button //
CreateText(11, "Insane")
SetTextSize(11, 50)
SetTextColor(11, 120, 0, 120, 255) // Purple
insanex = GetVirtualWidth()/2 - GetTextTotalWidth(11)/2
insaney = GetVirtualHeight()/2 + GetTextTotalHeight(11)
SetTextPosition(11, insanex, insaney)

// Difficulty Commands //
do
	// Easy Commands //
	if GetTextHitTest(8, GetPointerX(), GetPointerY())
		SetTextSize(8, 55)
		easyx = GetVirtualWidth()/2 - GetTextTotalWidth(8)/2
		easyy = GetVirtualHeight()/2 - GetTextTotalHeight(8)*2
		SetTextPosition(8, easyx, easyy)
		if GetPointerPressed() = 1
			speed = 20
			DeleteAllText()
			exit
		endif
	else
		SetTextSize(8, 50)
		easyx = GetVirtualWidth()/2 - GetTextTotalWidth(8)/2
		easyy = GetVirtualHeight()/2 - GetTextTotalHeight(8)*2
		SetTextPosition(8, easyx, easyy)
	endif
	
	// Intermediate Commands //
	if GetTextHitTest(9, GetPointerX(), GetPointerY())
		SetTextSize(9, 55)
		mediumx = GetVirtualWidth()/2 - GetTextTotalWidth(9)/2
		mediumy = GetVirtualHeight()/2 - GetTextTotalHeight(9)
		SetTextPosition(9, mediumx, mediumy)
		if GetPointerPressed() = 1
			speed = 10
			DeleteAllText()
			exit
		endif
	else
		SetTextSize(9, 50)
		mediumx = GetVirtualWidth()/2 - GetTextTotalWidth(9)/2
		mediumy = GetVirtualHeight()/2 - GetTextTotalHeight(9)
		SetTextPosition(9, mediumx, mediumy)
	endif
	
	// Hard Commands //
	if GetTextHitTest(10, GetPointerX(), GetPointerY())
		SetTextSize(10, 55)
		hardx = GetVirtualWidth()/2 - GetTextTotalWidth(10)/2
		hardy = GetVirtualHeight()/2 
		SetTextPosition(10, hardx, hardy)
		if GetPointerPressed() = 1
			speed = 5
			DeleteAllText()
			exit
		endif
	else
		SetTextSize(10, 50)
		hardx = GetVirtualWidth()/2 - GetTextTotalWidth(10)/2
		hardy = GetVirtualHeight()/2 
		SetTextPosition(10, hardx, hardy)
	endif
	
	// Insane Commands //
	if GetTextHitTest(11, GetPointerX(), GetPointerY())
		SetTextSize(11, 55)
		insanex = GetVirtualWidth()/2 - GetTextTotalWidth(11)/2
		insaney = GetVirtualHeight()/2 + GetTextTotalHeight(11)
		SetTextPosition(11, insanex, insaney)
		if GetPointerPressed() = 1
			speed = 1
			DeleteAllText()
			exit
		endif
	else
		SetTextSize(11, 50)
		insanex = GetVirtualWidth()/2 - GetTextTotalWidth(11)/2
		insaney = GetVirtualHeight()/2 + GetTextTotalHeight(11)
		SetTextPosition(11, insanex, insaney)
	endif
	sync()
loop

// **** In-game Sprites **** //

// Grass //
CreateSprite(4, 6)
SetSpriteSize(4, GetVirtualWidth(), GetVirtualHeight())

// Bunny //
CreateSprite(1, 1) // Bunny
SetSpriteScale(1, 0.25, 0.25)
bunnyx = GetVirtualWidth()/2 - GetSpriteWidth(1)/2
bunnyy = GetVirtualHeight()/2 - GetSpriteHeight(1)/2
SetSpritePosition(1, bunnyx, bunnyy)

// Egg1 //
CreateSprite(2, 2) // Egg1
SetSpriteScale(2, 0.25, 0.25)
egg1x = Random(0, GetVirtualWidth() - GetSpriteWidth(2))
egg1y = Random(0, GetVirtualHeight() - GetSpriteHeight(2))
SetSpritePosition(2, egg1x, egg1y)

// Egg2 //
CreateSprite(3, 3) // Egg2
SetSpriteScale(3, 0.25, 0.25)
egg2x = Random(0, GetVirtualWidth() - GetSpriteWidth(2))
egg2y = Random(0, GetVirtualHeight() - GetSpriteHeight(2))
SetSpritePosition(3, egg2x, egg2y)

// Rocks //
for x = 8 to 18
	CreateSprite(x, 7)
	SetSpriteColor(x, 150, 150, 150, 255)
	SetSpriteScale(x, 10, 10)
	rockx = Random(0, GetVirtualWidth() - GetSpriteWidth(x))
	rocky = Random(0, GetVirtualHeight() - GetSpriteHeight(x))
	SetSpritePosition(x, rockx, rocky)
	while GetSpriteCollision(x, 1) or GetSpriteCollision(x, 2) or GetSpriteCollision(x, 3)
		rockx = Random(0, GetVirtualWidth() - GetSpriteWidth(x))
		rocky = Random(0, GetVirtualHeight() - GetSpriteHeight(x))
		SetSpritePosition(x, rockx, rocky)
	endwhile
next 

// **** Texts **** //

// Score Text //
CreateText(1, "Score: " + str(score)) // Displays the score
SetTextColor(1, 255, 255, 255, 255)
SetTextPosition(1, 0, 0)
SetTextSize(1, 25)

// Time Text //
CreateText(2, "Time: " + str(time))
SetTextColor(2, 255, 255, 255, 255)
SetTextPosition(2, 0, GetTextTotalHeight(1))
SetTextSize(2, 25)

// Quit Button //
CreateText(7, "X")
SetTextSize(7, 30)
SetTextColor(7, 255, 0, 0, 255)
quitx = GetVirtualWidth() - GetTextTotalWidth(7) - 10
quity = 0
SetTextPosition(7, quitx, quity)

// **** In-Game **** //
do
	// **** Quit Commands **** //
	if GetTextHitTest(7, GetPointerX(), GetPointerY())
		if GetPointerReleased() = 1
			end
		endif
	endif
	// **** Timekeeping **** //
	second = second + 1
	if second = 30 // FPS of game
		second = 0
		time = time - 1
		SetTextString(2, "Time: " + str(time))
		if time <= 0
			exit
		endif
	endif
	
    // **** Bunny Key Controls **** //
    if GetRawKeyState(65) = 1 // "a" key
		SetSpriteFlip(1, 1, 0)
		if bunnyx > 0
			bunnyx = bunnyx - speed
		endif
	endif
	if GetRawKeyState(68) = 1 // "d" key
		SetSpriteFlip(1, 0, 0)
		if bunnyx < GetVirtualWidth() - GetSpriteWidth(1)
			bunnyx = bunnyx + speed
		endif
	endif
	if GetRawKeyState(87) = 1 // "w" key		
		if bunnyy > 0
			bunnyy = bunnyy - speed
		endif
	endif
	if GetRawKeyState(83) = 1 // "s" key		
		if bunnyy< GetVirtualHeight() - GetSpriteHeight(1)
		bunnyy = bunnyy + speed
		endif
	endif
	SetSpritePosition(1, bunnyx, bunnyy)
	
	// **** Sprite Collisions **** //
	
	// Bunny and Egg1 Collide //
	if GetSpriteCollision(1, 2) = 1
		while GetSpriteCollision(1, 2) = 1 or GetSpriteCollision(2, 3)
			egg1x = Random(0, GetVirtualWidth() - GetSpriteWidth(2))
			egg1y = Random(0, GetVirtualHeight() - GetSpriteHeight(2))
			SetSpritePosition(2, egg1x, egg1y)
		endwhile
		score = score + 1
		SetTextString(1, "Score: " + str(score))
	endif
	
	// Bunny and Egg2 Collide //
	if GetSpriteCollision(1, 3) = 1
		while GetSpriteCollision(1, 3) = 1 or GetSpriteCollision(3, 2)
			egg2x = Random(0, GetVirtualWidth() - GetSpriteWidth(2))
			egg2y = Random(0, GetVirtualHeight() - GetSpriteHeight(2))
			SetSpritePosition(3, egg2x, egg2y)
		endwhile
		score = score + 1
		SetTextString(1, "Score: " + str(score))
	endif
	
	// Bunny and Rock Collide
	for x = 8 to 18
		if GetSpriteExists(x) = 1
			if GetSpriteCollision(1, x)
				DeleteSprite(x)
			endif
		endif
	next

    Sync()
loop

// **** End Screen Stuff **** //

DeleteAllText()
DeleteAllSprites()
// Screen //
CreateSprite(5, 4)
SetSpriteSize(5, GetVirtualWidth(), GetVirtualHeight())

// Main Menu Button //
CreateText(3, "Main Menu")
SetTextSize(3, 50)
mainmenux = GetVirtualWidth()/2 - GetTextTotalWidth(3)/2
mainmenuy = GetVirtualHeight()/2
SetTextPosition(3, mainmenux, mainmenuy)
SetTextColor(3, 255, 215, 0, 255)

// Exit Button //
CreateText(4, "Exit")
SetTextSize(4, 50)
exitx = GetVirtualWidth()/2 - GetTextTotalWidth(4)/2
exity = GetVirtualHeight()*2/3 - GetTextTotalHeight(4)/2
SetTextPosition(4, exitx, exity)
SetTextColor(4, 255, 0, 0, 255)

// Final Score Display //
CreateText(6, "Score: " + str(score))
SetTextSize(6, 50)
SetTextColor(6, 255, 215, 0, 255)
finalscorex = GetVirtualWidth()/2 - GetTextTotalWidth(6)/2
finalscorey = GetVirtualHeight()/2 - GetTextTotalHeight(6)
SetTextPosition(6, finalscorex, finalscorey)

// **** End Screen **** //
do 
	// Main Menu Commands //
	if GetTextHitTest(3, GetPointerX(), GetPointerY())
		SetTextSize(3, 55)
		mainmenux = GetVirtualWidth()/2 - GetTextTotalWidth(3)/2
		mainmenuy = GetVirtualHeight()/2
		SetTextPosition(3, mainmenux, mainmenuy)
		if GetPointerReleased() = 1
			sync()
			DeleteAllText()
			DeleteAllSprites()
			DeleteAllImages()
			exit
		endif
	else
		SetTextSize(3, 50)
		mainmenux = GetVirtualWidth()/2 - GetTextTotalWidth(3)/2
		mainmenuy = GetVirtualHeight()/2
		SetTextPosition(3, mainmenux, mainmenuy)
	endif
	
	// Exit Button Commands //
	if GetTextHitTest(4, GetPointerX(), GetPointerY())
		SetTextSize(4, 55)
		exitx = GetVirtualWidth()/2 - GetTextTotalWidth(4)/2
		exity = GetVirtualHeight()*2/3 - GetTextTotalHeight(4)/2
		SetTextPosition(4, exitx, exity)
		if GetPointerReleased() = 1
			end
		endif
	else
		SetTextSize(4, 50)
		exitx = GetVirtualWidth()/2 - GetTextTotalWidth(4)/2
		exity = GetVirtualHeight()*2/3 - GetTextTotalHeight(4)/2
		SetTextPosition(4, exitx, exity)
	endif
	sync()
loop	
loop
